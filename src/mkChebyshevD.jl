# this file help me to make chebyshevD
function gauss_chebyshevint64(f)
    x,w= ([-0.9996988186962042, -0.9972904566786902, -0.99247953459871, -0.9852776423889412, -0.9757021300385285, -0.9637760657954398, -0.9495281805930367, -0.9329927988347388, -0.9142097557035307, -0.8932243011955152, -0.8700869911087113, -0.8448535652497071, -0.8175848131515836, -0.7883464276266062, -0.7572088465064847, -0.7242470829514668, -0.6895405447370669, -0.6531728429537765, -0.6152315905806267, -0.5758081914178453, -0.534997619887097, -0.492898192229784, -0.4496113296546067, -0.40524131400498975, -0.35989503653498817, -0.3136817403988914, -0.2667127574748983, -0.21910124015686966, -0.17096188876030124, -0.12241067519921615, -0.07356456359966733, -0.024541228522912142, 0.024541228522912264, 0.07356456359966745, 0.12241067519921628, 0.17096188876030136, 0.21910124015686977, 0.2667127574748984, 0.3136817403988916, 0.3598950365349883, 0.40524131400498986, 0.4496113296546066, 0.4928981922297841, 0.5349976198870973, 0.5758081914178453, 0.6152315905806268, 0.6531728429537769, 0.6895405447370669, 0.724247082951467, 0.7572088465064846, 0.7883464276266063, 0.8175848131515837, 0.8448535652497071, 0.8700869911087115, 0.8932243011955153, 0.9142097557035307, 0.932992798834739, 0.9495281805930367, 0.9637760657954398, 0.9757021300385286, 0.9852776423889412, 0.99247953459871, 0.9972904566786902, 0.9996988186962042], [0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052, 0.04908738521234052])
    result = 0.::Float64
    for i in eachindex(x)
        result+= f(x[i])*w[i]
    end
    result
end
chebyshev_D_step=3
chebyshevD=Array{Float64}(undef,kstep,kstep,chebyshev_D_step+1);

Threads.@threads for i=1:chebyshev_D_step
    for kn=1:kstep
        for  qn=1:kstep
            k2=meshk[kn]
            q2=meshk[qn]
            # @expand_D()
            if i==1
                chebyshevD[kn,qn,i]=gauss_chebyshevint64(z->D(k2+q2-2*sqrt(k2*q2)*z)chebyshevT(i-1,z))/pi
            else
                chebyshevD[kn,qn,i]=gauss_chebyshevint64(z->D(k2+q2-2*sqrt(k2*q2)*z)chebyshevT(i-1,z))*2/pi
            end
        end
    end
end

# 流程中使用的切比雪夫函数
function D_chebyshev(kn,qn,x)
    result=0.::Float64
    for i=1:chebyshev_D_step
        result+=chebyshevD[kn,qn,i]*chebyshevT(i-1,x)
    end
    result*=1
    return result
end

# Threads.@threads for i=1:chebyshev_D_step
#     for kn=1:kstep
#         for  qn=1:kstep
#             k2=meshk[kn]
#             q2=meshk[qn]
#             # @expand_D()
#             chebyshevD[kn,qn,i]=gausschebyshevint64(z->D(k2+q2-2*sqrt(k2*q2)*z)chebyshevU(i-1,z))*2/pi
#         end
#     end
# end

# function D_chebyshev(kn,qn,x)
#     result=0.::Float64
#     for i=1:chebyshev_D_step
#         result+=chebyshevD[kn,qn,i]*chebyshevU(i-1,x)
#     end
#     result*=1
#     return result
# end
print("chebyshev expand is done\n")